<project name="OpenRocket" basedir="." default="jar">

	<!-- COMPLETE -->
	
	<target name="complete" depends="clean, check, jar, unittest">
	</target>
	
	<target name="complete-core" depends="clean-core, check, jar-core, unittest-core">
	</target>
	
	<target name="complete-swing" depends="clean-swing, check, jar-swing, unittest-swing">
	</target>

    <!-- CLEAN -->

	<target name="clean" depends="clean-core, clean-swing">
	</target>

	<target name="clean-core">
		<ant dir="core" target="clean"/>
	</target>

	<target name="clean-swing">
		<ant dir="swing" target="clean"/>
	</target>


    <!-- BUILD -->

	<target name="build-pre">
		<echo>java.vendor: ${java.vendor}</echo>
		<echo>java.home: ${java.home}</echo>
		<echo>java.vm.specification.version: ${java.vm.specification.version}</echo>
		<echo>java.vm.specification.vendor: ${java.vm.specification.vendor}</echo>
		<echo>java.vm.specification.name: ${java.vm.specification.name}</echo>
		<echo>java.vm.version: ${java.vm.version}</echo>
		<echo>java.vm.vendor: ${java.vm.vendor}</echo>
		<echo>java.vm.name: ${java.vm.name}</echo>
		<echo>java.specification.version: ${java.specification.version}</echo>
		<echo>java.specification.vendor: ${java.specification.vendor}</echo>
		<echo>java.specification.name: ${java.specification.name}</echo>
		<echo>java.class.version: ${java.class.version}</echo>
		<echo>java.class.path: ${java.class.path}</echo>
	</target>

	<target name="build" depends="build-pre, build-core, build-swing">
	</target>

	<target name="build-core">
		<ant dir="core" target="build"/>
	</target>
	
	<target name="build-swing" depends="jar-core">
		<ant dir="swing" target="build"/>
	</target>

    <!-- JAR -->
	
	<target name="jar" depends="jar-core,jar-swing">
	</target>
	
	<target name="jar-core" depends="build-core">
		<ant dir="core" target="jar"/>
	</target>
	
	<target name="jar-swing" depends="build-swing">
		<ant dir="swing" target="jar"/>
	</target>

    <!-- TEST -->
	
	<target name="unittest" depends="unittest-core, unittest-swing">
	</target>
	
	<target name="unittest-core" depends="jar-core">
		<ant dir="core" target="unittest" inheritAll="false" />
	</target>
	
	<target name="unittest-swing" depends="jar-swing">
		<ant dir="swing" target="unittest" inheritAll="false" />
	</target>

    <!-- CHECK -->
    <target name="check" depends="checktodo,checkascii"/>

    <!-- CHECK TODOs -->
    <target name="todo" depends="checktodo"/>
    <target name="checktodo">
        <tempfile property="todo.file" prefix="checktodo-" destDir="${basedir}"/>
        <echo>Checking project for FIXMEs.</echo>
        <concat destfile="${todo.file}">
            <fileset dir="core/src">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="core/test">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="swing/src">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="swing/test">
                <include name="**/*.java"/>
            </fileset>
            <filterchain>
                <linecontainsregexp>
                    <regexp pattern="(FIXME|TODO:.*CRITICAL)"/>
                </linecontainsregexp>
            </filterchain>
        </concat>
        <loadfile srcfile="${todo.file}" property="criticaltodos"/>
        <delete file="${todo.file}"/>
        <fail if="criticaltodos">CRITICAL TODOs exist in project:
${criticaltodos}</fail>
        <echo>No critical TODOs in project.</echo>
    </target>

    <!-- CHECK ASCII -->
    <target name="ascii" depends="checkascii"/>
    <target name="checkascii">
        <tempfile property="ascii.file" prefix="checkascii-" destDir="${basedir}"/>
        <echo>Checking project for non-ASCII characters.</echo>
        <concat destfile="${ascii.file}">
            <fileset dir="core/src">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="core/test">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="swing/src">
                <include name="**/*.java"/>
            </fileset>
            <fileset dir="swing/test">
                <include name="**/*.java"/>
            </fileset>
            <filterchain>
                <linecontainsregexp>
                    <regexp pattern="\P{ASCII}"/>
                </linecontainsregexp>
            </filterchain>
        </concat>
        <loadfile srcfile="${ascii.file}" property="nonascii"/>
        <delete file="${ascii.file}"/>
        <fail if="nonascii">Non-ASCII characters exist in project:
${nonascii}</fail>
        <echo>No non-ASCII characters in project.</echo>
    </target>

</project>
